<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10th Quiz Pro ЁЯОУ</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #6200ea; --success: #4caf50; --error: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #333; }
        .card { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 90%; max-width: 450px; text-align: center; }
        h1 { color: var(--primary); margin-bottom: 10px; }
        button { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 14px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; margin: 10px 0; transition: 0.3s; box-shadow: 0 4px 10px rgba(98, 0, 234, 0.2); }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(98, 0, 234, 0.3); }
        input { width: 100%; padding: 14px; margin: 15px 0; border: 2px solid #eee; border-radius: 12px; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); }
        .option-btn { background: #f8f9fa; color: #444; border: 2px solid #eee; text-align: left; margin: 8px 0; font-weight: normal; }
        .correct { background: #c8e6c9 !important; border-color: var(--success) !important; color: #2e7d32; }
        .wrong { background: #ffcdd2 !important; border-color: var(--error) !important; color: #c62828; }
        .hidden { display: none; }
        .timer { color: var(--error); font-weight: bold; font-size: 18px; background: #ffebee; padding: 5px 15px; border-radius: 20px; }
        .rank-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; background: #fff; margin-bottom: 5px; border-radius: 10px; }
    </style>
</head>
<body>

<div id="login-screen" class="card">
    <h1>10th Quiz Pro ЁЯОУ</h1>
    <p>рдХрдХреНрд╖рд╛ 10 рдХреА рдмреЗрд╣рддрд░реАрди рддреИрдпрд╛рд░реА рдХреЗ рд▓рд┐рдП</p>
    <button onclick="googleLogin()">Google рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ</button>
</div>

<div id="name-screen" class="card hidden">
    <h2>рдЖрдкрдХрд╛ рд╢реБрдн рдирд╛рдо?</h2>
    <input type="text" id="userName" placeholder="рдЕрдкрдирд╛ рдкреВрд░рд╛ рдирд╛рдо рдпрд╣рд╛рдБ рд▓рд┐рдЦреЗрдВ">
    <button onclick="saveName()">рдХреНрд╡рд┐рдЬрд╝ рд╢реБрд░реВ рдХрд░реЗрдВ ЁЯЪА</button>
</div>

<div id="subject-screen" class="card hidden">
    <h2>рд╡рд┐рд╖рдп рдЪреБрдирд┐рдП ЁЯУЪ</h2>
    <button class="option-btn" onclick="startQuiz('Hindi')">ЁЯЗоЁЯЗ│ рд╣рд┐рдВрджреА</button>
    <button class="option-btn" onclick="startQuiz('English')">ЁЯЗмЁЯЗз рдЕрдВрдЧреНрд░реЗрдЬреА</button>
    <button class="option-btn" onclick="startQuiz('Maths')">ЁЯФв рдЧрдгрд┐рдд</button>
    <button class="option-btn" onclick="startQuiz('Science')">ЁЯФм рд╡рд┐рдЬреНрдЮрд╛рди</button>
    <button class="option-btn" onclick="startQuiz('SST')">ЁЯМН рд╕рд╛рдорд╛рдЬрд┐рдХ рд╡рд┐рдЬреНрдЮрд╛рди</button>
    <button class="option-btn" onclick="startQuiz('Sanskrit')">ЁЯХЙя╕П рд╕рдВрд╕реНрдХреГрдд</button>
</div>

<div id="quiz-screen" class="card hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span id="q-info" style="font-weight: bold;">рд╕рд╡рд╛рд▓: 1/15</span>
        <span id="timer" class="timer">15:00</span>
    </div>
    <h3 id="q-text" style="min-height: 60px;">рд╕рд╡рд╛рд▓ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</h3>
    <div id="options-box"></div>
</div>

<div id="result-screen" class="card hidden">
    <h2>рдЖрдкрдХрд╛ рдкрд░рд┐рдгрд╛рдо ЁЯУЛ</h2>
    <h1 id="res-score" style="font-size: 48px; margin: 10px 0;">0/100</h1>
    <p id="res-advice" style="font-size: 18px; margin-bottom: 20px;"></p>
    <hr style="border: 0; border-top: 1px solid #eee;">
    <h3>ЁЯПЖ рдЯреЙрдк рд░реИрдВрдХрд┐рдВрдЧ (Leaderboard)</h3>
    <div id="leaderboard" style="margin-top: 15px;"></div>
    <button onclick="location.reload()" style="margin-top: 20px;">рдлрд┐рд░ рд╕реЗ рдЦреЗрд▓реЗрдВ ЁЯФД</button>
</div>

<script>
    // рдЖрдкрдХреА рдЕрд╕рд▓реА Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyCJFK5xs9_gLI1Z-pKMjqSnPcPQs3-iHx8",
        authDomain: "th-quiz-app-pro-59ed3.firebaseapp.com",
        projectId: "th-quiz-app-pro-59ed3",
        storageBucket: "th-quiz-app-pro-59ed3.firebasestorage.app",
        messagingSenderId: "914051046097",
        appId: "1:914051046097:web:0d7986357ebc7f5e5083f0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // "Missing initial state" рдПрд░рд░ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП Popup рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░реЗрдВ
    function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
            .then(() => showScreen('name-screen'))
            .catch(err => {
                alert("рд▓реЙрдЧрд┐рди рдлреЗрд▓: " + err.message);
                console.error(err);
            });
    }

    function saveName() {
        const name = document.getElementById('userName').value.trim();
        if(!name) return alert("рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ!");
        localStorage.setItem('studentName', name);
        showScreen('subject-screen');
    }

    function showScreen(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    let currentQuestions = [];
    let qIndex = 0;
    let score = 0;
    let timeLeft = 900; 
    let timerInterval;

    async function startQuiz(subject) {
        showScreen('quiz-screen');
        try {
            const response = await fetch('questions.json');
            const data = await response.json();
            let filtered = data.filter(q => q.subject === subject);
            
            if(filtered.length < 1) {
                alert("рдЗрд╕ рд╡рд┐рд╖рдп рдХреЗ рд╕рд╡рд╛рд▓ рдЕрднреА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИрдВ!");
                return location.reload();
            }

            // рд░реИрдВрдбрдо 15 рд╕рд╡рд╛рд▓
            currentQuestions = filtered.sort(() => 0.5 - Math.random()).slice(0, 15);
            loadQuestion();
            startTimer();
        } catch (e) {
            alert("рд╕рд╡рд╛рд▓реЛрдВ рдХреА рдлрд╛рдЗрд▓ (questions.json) рдирд╣реАрдВ рдорд┐рд▓реА!");
        }
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(timeLeft <= 0) endQuiz();
        }, 1000);
    }

    function loadQuestion() {
        if(qIndex >= currentQuestions.length) return endQuiz();
        const q = currentQuestions[qIndex];
        document.getElementById('q-info').innerText = `рд╕рд╡рд╛рд▓: ${qIndex + 1}/${currentQuestions.length}`;
        document.getElementById('q-text').innerText = q.question;
        
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        
        // рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╢рдлрд▓ рдХрд░рдирд╛
        let shuffled = [...q.options].sort(() => 0.5 - Math.random());
        shuffled.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'button option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAns(btn, opt, q.answer);
            box.appendChild(btn);
        });
    }

    function checkAns(btn, selected, correct) {
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.style.pointerEvents = 'none');

        if(selected === correct) {
            btn.classList.add('correct'); // рд╕рд╣реА рдкрд░ рд╣рд░рд╛
            score += (100/15);
        } else {
            btn.classList.add('wrong'); // рдЧрд▓рдд рдкрд░ рд▓рд╛рд▓
            btns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
        }

        setTimeout(() => {
            qIndex++;
            loadQuestion();
        }, 1200);
    }

    async function endQuiz() {
        clearInterval(timerInterval);
        showScreen('result-screen');
        const finalScore = Math.round(score);
        const name = localStorage.getItem('studentName');
        
        document.getElementById('res-score').innerText = `${finalScore}/100`;
        
        // рдкрдврд╝рд╛рдИ рдХреА рд╕рд▓рд╛рд╣
        let advice = "";
        if(finalScore >= 80) advice = "рд╢рд╛рдирджрд╛рд░! рдЖрдкрдХреА рддреИрдпрд╛рд░реА рдмрд╣реБрдд рдордЬрдмреВрдд рд╣реИред ЁЯФе";
        else if(finalScore >= 50) advice = "рдЕрдЪреНрдЫрд╛ рдкреНрд░рдпрд╛рд╕, рдереЛрдбрд╝реА рдФрд░ рдореЗрд╣рдирдд рдХрд░реЗрдВред ЁЯУЦ";
        else advice = "рдЖрдкрдХреЛ рдЕрднреА рдмрд╣реБрдд рдЕрдзрд┐рдХ рдкрдврд╝рд╛рдИ рдХреА рдЬрд░реВрд░рдд рд╣реИред тЭМ";
        document.getElementById('res-advice').innerText = advice;

        // рд░реИрдВрдХрд┐рдВрдЧ рд╕реЗрд╡ рдФрд░ рд▓реЛрдб рдХрд░рдирд╛
        try {
            const user = auth.currentUser;
            if(user) {
                await db.collection("ranks").doc(user.uid).set({ name: name, score: finalScore });
            }
            
            const snap = await db.collection("ranks").orderBy("score", "desc").limit(5).get();
            let html = "";
            snap.forEach(doc => {
                html += `<div class="rank-item"><span>ЁЯСд ${doc.data().name}</span><span><b>${doc.data().score}</b> pts</span></div>`;
            });
            document.getElementById('leaderboard').innerHTML = html || "рдЕрднреА рдХреЛрдИ рдбреЗрдЯрд╛ рдирд╣реАрдВ рд╣реИред";
        } catch (e) {
            console.error("рд░реИрдВрдХрд┐рдВрдЧ рдПрд░рд░:", e);
        }
    }
</script>
</body>
</html>
