<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10th Quiz Pro - All in One</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --primary: #6200ea; --success: #4caf50; --error: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 500px; text-align: center; }
        button { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; cursor: pointer; width: 100%; font-size: 16px; margin: 10px 0; transition: 0.3s; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .option-btn { background: white; color: #333; border: 2px solid #ddd; text-align: left; }
        .correct { background: #c8e6c9 !important; border-color: var(--success) !important; }
        .wrong { background: #ffcdd2 !important; border-color: var(--error) !important; }
        .hidden { display: none; }
        .timer { color: var(--error); font-weight: bold; font-size: 18px; }
        .rank-list { text-align: left; margin-top: 15px; }
        .rank-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div id="login-screen" class="card">
    <h1>10th Quiz Pro üéì</h1>
    <p>‡§Ö‡§™‡§®‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡•ã ‡§¨‡•á‡§π‡§§‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç</p>
    <button onclick="googleLogin()">Google ‡§ï‡•á ‡§∏‡§æ‡§• ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
    <button id="install-btn" class="hidden" style="background: #333;">App ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<div id="name-screen" class="card hidden">
    <h2>‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?</h2>
    <input type="text" id="userName" placeholder="‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç">
    <button onclick="saveName()">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<div id="subject-screen" class="card hidden">
    <h2>‡§µ‡§ø‡§∑‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç üìö</h2>
    <button class="option-btn" onclick="startQuiz('Hindi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    <button class="option-btn" onclick="startQuiz('English')">‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä</button>
    <button class="option-btn" onclick="startQuiz('Maths')">‡§ó‡§£‡§ø‡§§</button>
    <button class="option-btn" onclick="startQuiz('Science')">‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®</button>
    <button class="option-btn" onclick="startQuiz('SST')">‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®</button>
    <button class="option-btn" onclick="startQuiz('Sanskrit')">‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§</button>
</div>

<div id="quiz-screen" class="card hidden">
    <div style="display: flex; justify-content: space-between;">
        <span id="q-info">1/15</span>
        <span id="timer" class="timer">15:00</span>
    </div>
    <h3 id="q-text">‡§∏‡§µ‡§æ‡§≤ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</h3>
    <div id="options-box"></div>
</div>

<div id="result-screen" class="card hidden">
    <h2 id="res-title">‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü</h2>
    <h1 id="res-score">0/100</h1>
    <p id="res-advice"></p>
    <hr>
    <h3>üèÜ ‡§≤‡•Ä‡§°‡§∞‡§¨‡•ã‡§∞‡•ç‡§°</h3>
    <div id="leaderboard" class="rank-list"></div>
    <button onclick="location.reload()">‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç</button>
</div>

<script>
    // Firebase Setup
    const firebaseConfig = {
        apiKey: "AIzaSyCJFK5xs9_gLI1Z-pKMjqSnPcPQs3-iHx8",
        authDomain: "th-quiz-app-pro-59ed3.firebaseapp.com",
        projectId: "th-quiz-app-pro-59ed3",
        storageBucket: "th-quiz-app-pro-59ed3.firebasestorage.app",
        messagingSenderId: "914051046097",
        appId: "1:914051046097:web:0d7986357ebc7f5e5083f0"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentQuestions = [];
    let qIndex = 0;
    let score = 0;
    let timeLeft = 900;
    let timerInterval;

    // ‡§≤‡•â‡§ó‡§ø‡§® ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).then(() => {
            showScreen('name-screen');
        }).catch(err => alert(err.message));
    }

    function saveName() {
        const name = document.getElementById('userName').value;
        if(!name) return alert("‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç!");
        localStorage.setItem('studentName', name);
        showScreen('subject-screen');
    }

    function showScreen(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    // ‡§ï‡•ç‡§µ‡§ø‡§ú‡§º ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
    async function startQuiz(subject) {
        showScreen('quiz-screen');
        const response = await fetch('questions.json');
        const data = await response.json();
        
        // ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§î‡§∞ ‡§∞‡•à‡§Ç‡§°‡§Æ 15 ‡§∏‡§µ‡§æ‡§≤
        let filtered = data.filter(q => q.subject === subject);
        currentQuestions = filtered.sort(() => 0.5 - Math.random()).slice(0, 15);
        
        loadQuestion();
        startTimer();
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60);
            let s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
            if(timeLeft <= 0) endQuiz();
        }, 1000);
    }

    function loadQuestion() {
        if(qIndex >= 15) return endQuiz();
        const q = currentQuestions[qIndex];
        document.getElementById('q-info').innerText = `${qIndex + 1}/15`;
        document.getElementById('q-text').innerText = q.question;
        
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        
        // ‡§â‡§§‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∂‡§´‡§≤ ‡§ï‡§∞‡§®‡§æ
        q.options.sort(() => 0.5 - Math.random()).forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'button option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAns(btn, opt, q.answer);
            box.appendChild(btn);
        });
    }

    function checkAns(btn, selected, correct) {
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.style.pointerEvents = 'none');

        if(selected === correct) {
            btn.classList.add('correct'); // ‡§∏‡§π‡•Ä ‡§™‡§∞ ‡§π‡§∞‡§æ
            score += (100/15);
        } else {
            btn.classList.add('wrong'); // ‡§ó‡§≤‡§§ ‡§™‡§∞ ‡§≤‡§æ‡§≤
            btns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
        }

        setTimeout(() => {
            qIndex++;
            loadQuestion();
        }, 1500);
    }

    async function endQuiz() {
        clearInterval(timerInterval);
        showScreen('result-screen');
        const finalScore = Math.round(score);
        const name = localStorage.getItem('studentName');
        
        document.getElementById('res-score').innerText = `${finalScore}/100`;
        
        // ‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π
        let advice = finalScore >= 80 ? "‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä! üî•" : (finalScore >= 50 ? "‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§ï‡•ã‡§∂‡§ø‡§∂, ‡§î‡§∞ ‡§∏‡•Å‡§ß‡§æ‡§∞‡•á‡§Ç‡•§ üìñ" : "‡§Ü‡§™‡§ï‡•ã ‡§¨‡§π‡•Å‡§§ ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡§§ ‡§π‡•à‡•§ ‚ùå");
        document.getElementById('res-advice').innerText = advice;

        // ‡§∞‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•á‡§µ ‡§î‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
        const user = auth.currentUser;
        await db.collection("ranks").doc(user.uid).set({ name: name, score: finalScore });
        
        const snap = await db.collection("ranks").orderBy("score", "desc").limit(5).get();
        let html = "";
        snap.forEach(doc => {
            html += `<div class="rank-item"><span>${doc.data().name}</span><span>${doc.data().score} pts</span></div>`;
        });
        document.getElementById('leaderboard').innerHTML = html;
    }

    // ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§¨‡§ü‡§® ‡§≤‡•â‡§ú‡§ø‡§ï
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('install-btn').classList.remove('hidden');
    });

    document.getElementById('install-btn').onclick = () => {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => {
            document.getElementById('install-btn').classList.add('hidden');
        });
    };
</script>
</body>
</html>
