<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Play - 10th Quiz App Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .subject-btn { padding: 15px; margin: 10px; width: 80%; font-size: 18px; border-radius: 10px; border: none; background: #4285F4; color: white; cursor: pointer; }
        .option-btn { display: block; width: 100%; padding: 12px; margin: 8px 0; border: 2px solid #ddd; border-radius: 8px; background: white; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .correct { background-color: #4CAF50 !important; color: white; border-color: #4CAF50; }
        .wrong { background-color: #f44336 !important; color: white; border-color: #f44336; }
        .hidden { display: none; }
        #timer { font-weight: bold; color: #d9534f; margin-bottom: 10px; }
        #result-card { border: 2px solid #4285F4; padding: 20px; border-radius: 15px; background: #fff; }
    </style>
</head>
<body>

<div class="container" id="main-container">
    <h1 id="app-title">10th Quiz App Pro</h1>
    
    <div id="subject-screen">
        <h3>अपना विषय चुनें:</h3>
        <button class="subject-btn" onclick="startQuiz('Hindi')">हिंदी</button>
        <button class="subject-btn" onclick="startQuiz('English')">अंग्रेजी</button>
        <button class="subject-btn" onclick="startQuiz('Science')">विज्ञान</button>
        <button class="subject-btn" onclick="startQuiz('Math')">गणित</button>
        <button class="subject-btn" onclick="startQuiz('SST')">सामाजिक विज्ञान</button>
        <button class="subject-btn" onclick="startQuiz('Sanskrit')">संस्कृत</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div id="quiz-header">
            <span id="q-count">प्रश्न: 1/15</span>
        </div>
        <h2 id="question-text">प्रश्न यहाँ दिखेगा...</h2>
        <div id="options-container"></div>
    </div>

    <div id="result-screen" class="hidden">
        <div id="result-card">
            <h2>आपका रिजल्ट कार्ड</h2>
            <p id="res-name">नाम: लोड हो रहा है...</p>
            <p id="res-score">सही उत्तर: 0/15</p>
            <p id="res-accuracy">एक्यूरेसी: 0%</p>
            <p id="res-rank" style="font-size: 24px; color: #4285F4; font-weight: bold;">रैंक: #1</p>
        </div>
        <br>
        <button class="subject-btn" style="background:#28a745;" onclick="downloadResult()">रिजल्ट डाउनलोड करें</button>
        <button class="subject-btn" onclick="location.reload()">दोबारा प्रयास करें</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, collection, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // आपका Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyC1JPSXHgITHS0Nl2HO-gPgHzfsfO8wLxk",
      authDomain: "th-quiz-app-pro-90dfe.firebaseapp.com",
      projectId: "th-quiz-app-pro-90dfe",
      storageBucket: "th-quiz-app-pro-90dfe.firebasestorage.app",
      messagingSenderId: "1033911634573",
      appId: "1:1033911634573:web:81fafa7d7158d4d974f0c4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);

    let questions = [];
    let currentQIndex = 0;
    let score = 0;
    let userName = "";

    // लॉगिन यूजर का नाम प्राप्त करें
    auth.onAuthStateChanged(user => {
        if (user) userName = user.displayName;
        else window.location.href = "index.html"; 
    });

    // क्विज़ शुरू करने का फंक्शन
    window.startQuiz = async (subject) => {
        document.getElementById('subject-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        
        // असल में यहाँ questions.json से डेटा आएगा, अभी 15 रैंडम सवाल बना रहे हैं
        questions = Array.from({length: 15}, (_, i) => ({
            q: `${subject} प्रश्न संख्या ${i+1}`,
            options: ["सही उत्तर", "गलत 1", "गलत 2", "गलत 3"].sort(() => Math.random() - 0.5),
            correct: "सही उत्तर"
        }));
        
        showQuestion();
    };

    function showQuestion() {
        if (currentQIndex >= 15) {
            showResult();
            return;
        }
        
        const q = questions[currentQIndex];
        document.getElementById('q-count').innerText = `प्रश्न: ${currentQIndex + 1}/15`;
        document.getElementById('question-text').innerText = q.q;
        const container = document.getElementById('options-container');
        container.innerHTML = "";

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.correct);
            container.appendChild(btn);
        });
    }

    function checkAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if (selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            allBtns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
        }

        setTimeout(() => {
            currentQIndex++;
            showQuestion();
        }, 500); // 0.5 सेकंड का गैप जैसा आपने नोट में लिखा था
    }

    async function showResult() {
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        
        const accuracy = Math.round((score / 15) * 100);
        document.getElementById('res-name').innerText = "नाम: " + userName;
        document.getElementById('res-score').innerText = `सही उत्तर: ${score}/15`;
        document.getElementById('res-accuracy').innerText = `एक्यूरेसी: ${accuracy}%`;

        // डेटाबेस में स्कोर सेव करें और रैंक निकालें
        const userRef = doc(db, "leaderboard", auth.currentUser.uid);
        await setDoc(userRef, { name: userName, score: score, timestamp: new Date() });

        const q = query(collection(db, "leaderboard"), orderBy("score", "desc"));
        const snapshot = await getDocs(q);
        let rank = 1;
        snapshot.forEach((doc, index) => {
            if (doc.id === auth.currentUser.uid) rank = index + 1;
        });
        document.getElementById('res-rank').innerText = `आपकी रैंक: #${rank}`;
    }

    // रिजल्ट डाउनलोड फंक्शन
    window.downloadResult = () => {
        html2canvas(document.getElementById("result-card")).then(canvas => {
            let link = document.createElement("a");
            link.download = "Quiz_Result.png";
            link.href = canvas.toDataURL();
            link.click();
        });
    };
</script>

</body>
</html>
