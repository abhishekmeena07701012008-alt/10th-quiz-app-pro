<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10th Quiz Pro ЁЯОУ</title>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #6200ea; --success: #4caf50; --error: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .card { background: white; padding: 30px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 90%; max-width: 450px; text-align: center; }
        button { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 14px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; margin: 10px 0; transition: 0.3s; }
        .option-btn { background: #f8f9fa; color: #444; border: 2px solid #eee; text-align: left; }
        .correct { background: #c8e6c9 !important; border-color: var(--success) !important; }
        .wrong { background: #ffcdd2 !important; border-color: var(--error) !important; }
        .hidden { display: none; }
        .timer { color: var(--error); font-weight: bold; padding: 5px 15px; background: #ffebee; border-radius: 20px; }
        .rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div id="login-screen" class="card">
    <h1>10th Quiz Pro ЁЯОУ</h1>
    <p>рдЕрдкрдиреА рддреИрдпрд╛рд░реА рдХреЛ рдФрд░ рдордЬрдмреВрдд рдмрдирд╛рдПрдВ</p>
    <button onclick="googleLogin()">Google рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ</button>
</div>

<div id="name-screen" class="card hidden">
    <h2>рдЖрдкрдХрд╛ рдирд╛рдо?</h2>
    <input type="text" id="userName" style="width:90%; padding:12px; margin:15px 0; border-radius:10px; border:1px solid #ddd;" placeholder="рдкреВрд░рд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ">
    <button onclick="saveName()">рд╢реБрд░реВ рдХрд░реЗрдВ ЁЯЪА</button>
</div>

<div id="subject-screen" class="card hidden">
    <h2>рд╡рд┐рд╖рдп рдЪреБрдирд┐рдП ЁЯУЪ</h2>
    <button class="option-btn" style="width:100%; padding:12px; margin:5px 0; border-radius:10px; cursor:pointer;" onclick="startQuiz('Hindi')">рд╣рд┐рдВрджреА</button>
    <button class="option-btn" style="width:100%; padding:12px; margin:5px 0; border-radius:10px; cursor:pointer;" onclick="startQuiz('English')">рдЕрдВрдЧреНрд░реЗрдЬреА</button>
    <button class="option-btn" style="width:100%; padding:12px; margin:5px 0; border-radius:10px; cursor:pointer;" onclick="startQuiz('Maths')">рдЧрдгрд┐рдд</button>
    <button class="option-btn" style="width:100%; padding:12px; margin:5px 0; border-radius:10px; cursor:pointer;" onclick="startQuiz('Science')">рд╡рд┐рдЬреНрдЮрд╛рди</button>
    <button class="option-btn" style="width:100%; padding:12px; margin:5px 0; border-radius:10px; cursor:pointer;" onclick="startQuiz('SST')">рд╕рд╛рдорд╛рдЬрд┐рдХ рд╡рд┐рдЬреНрдЮрд╛рди</button>
    <button class="option-btn" style="width:100%; padding:12px; margin:5px 0; border-radius:10px; cursor:pointer;" onclick="startQuiz('Sanskrit')">рд╕рдВрд╕реНрдХреГрдд</button>
</div>

<div id="quiz-screen" class="card hidden">
    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
        <span id="q-info">рд╕рд╡рд╛рд▓: 1/15</span>
        <span id="timer" class="timer">15:00</span>
    </div>
    <h3 id="q-text">рд╕рд╡рд╛рд▓ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</h3>
    <div id="options-box"></div>
</div>

<div id="result-screen" class="card hidden">
    <h2>рдкрд░рд┐рдгрд╛рдо ЁЯУЛ</h2>
    <h1 id="res-score">0/100</h1>
    <p id="res-advice"></p>
    <hr>
    <h3>ЁЯПЖ рдЯреЙрдк 5 рдЫрд╛рддреНрд░</h3>
    <div id="leaderboard"></div>
    <button onclick="location.reload()">рдлрд┐рд░ рд╕реЗ рдЦреЗрд▓реЗрдВ</button>
</div>

<script>
    // рдЖрдкрдХреА рдЕрд╕рд▓реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди
    const firebaseConfig = {
        apiKey: "AIzaSyCJFK5xs9_gLI1Z-pKMjqSnPcPQs3-iHx8",
        authDomain: "th-quiz-app-pro-59ed3.firebaseapp.com",
        projectId: "th-quiz-app-pro-59ed3",
        storageBucket: "th-quiz-app-pro-59ed3.firebasestorage.app",
        messagingSenderId: "914051046097",
        appId: "1:914051046097:web:0d7986357ebc7f5e5083f0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // рдПрд░рд░ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП PopUp рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓
    function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider)
            .then(() => showScreen('name-screen'))
            .catch(err => alert("рд▓реЙрдЧрд┐рди рдПрд░рд░: " + err.message));
    }

    function saveName() {
        const name = document.getElementById('userName').value.trim();
        if(!name) return alert("рдирд╛рдо рд▓рд┐рдЦреЗрдВ!");
        localStorage.setItem('studentName', name);
        showScreen('subject-screen');
    }

    function showScreen(id) {
        document.querySelectorAll('.card').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    let currentQuestions = [];
    let qIndex = 0;
    let score = 0;
    let timeLeft = 900;
    let timerId;

    async function startQuiz(subject) {
        showScreen('quiz-screen');
        const res = await fetch('questions.json');
        const data = await res.json();
        let filtered = data.filter(q => q.subject === subject);
        currentQuestions = filtered.sort(() => 0.5 - Math.random()).slice(0, 15);
        loadQuestion();
        timerId = setInterval(() => {
            timeLeft--;
            let m = Math.floor(timeLeft/60), s = timeLeft%60;
            document.getElementById('timer').innerText = `${m}:${s<10?'0'+s:s}`;
            if(timeLeft<=0) endQuiz();
        }, 1000);
    }

    function loadQuestion() {
        if(qIndex >= currentQuestions.length) return endQuiz();
        const q = currentQuestions[qIndex];
        document.getElementById('q-info').innerText = `рд╕рд╡рд╛рд▓: ${qIndex+1}/15`;
        document.getElementById('q-text').innerText = q.question;
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        [...q.options].sort(() => 0.5-Math.random()).forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.style = "width:100%; padding:10px; margin:5px 0; border-radius:10px; cursor:pointer;";
            btn.innerText = opt;
            btn.onclick = () => {
                const btns = box.querySelectorAll('button');
                btns.forEach(b => b.style.pointerEvents = 'none');
                if(opt === q.answer) { btn.classList.add('correct'); score += (100/15); }
                else { btn.classList.add('wrong'); btns.forEach(b => { if(b.innerText === q.answer) b.classList.add('correct'); }); }
                setTimeout(() => { qIndex++; loadQuestion(); }, 1200);
            };
            box.appendChild(btn);
        });
    }

    async function endQuiz() {
        clearInterval(timerId);
        showScreen('result-screen');
        const finalScore = Math.round(score);
        document.getElementById('res-score').innerText = `${finalScore}/100`;
        let advice = finalScore >= 80 ? "рд╢рд╛рдирджрд╛рд░! тЬЕ" : (finalScore >= 50 ? "рдЕрдЪреНрдЫреА рдХреЛрд╢рд┐рд╢! ЁЯУЦ" : "рдореЗрд╣рдирдд рдХреА рдЬрд░реВрд░рдд рд╣реИ! тЭМ");
        document.getElementById('res-advice').innerText = advice;
        
        const user = auth.currentUser;
        await db.collection("ranks").doc(user.uid).set({ name: localStorage.getItem('studentName'), score: finalScore });
        const snap = await db.collection("ranks").orderBy("score", "desc").limit(5).get();
        let html = "";
        snap.forEach(doc => html += `<div class="rank-item"><span>${doc.data().name}</span><span>${doc.data().score} pts</span></div>`);
        document.getElementById('leaderboard').innerHTML = html;
    }
</script>
</body>
</html>
